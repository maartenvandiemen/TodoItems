trigger:
- master

pool:
  vmImage: ubuntu-latest

extends:
   template: build.generic.yml
   parameters:
     bicepTemplate: main.docker.webapp.bicep
     bicepAdditionalParameters: '-dockerImageNameAndTag ghcr.io/mvdiemen/todoitems:$(Build.SourceVersion)'
     postBuildSteps: 
       - task: Docker@2
         inputs:
           containerRegistry: 'Github Packages'
           repository: $(Build.Repository.Name)
           command: 'buildAndPush'
           Dockerfile: '**/Dockerfile'
           buildContext: '$(Build.ArtifactStagingDirectory)/todoItemsApi'
           tags: '$(Build.SourceVersion)'
